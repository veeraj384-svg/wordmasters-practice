<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Week 2 Writing</title>
<link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
<script src="/assets/ui.js"></script>

<div class="wrap">
  <div class="bar">
    <div>
      <h1>Week 2 Writing</h1>
      <p class="sub">Write one strong sentence per word. It checks if the word is used + basic quality signals.</p>
    </div>
    <div class="actions">
      <span id="score" class="pill">Used: 0 / 25 • Quality: 0 / 25</span>
      <button class="btn" onclick="check()">Check</button>
      <button class="btn" onclick="resetAll()">Reset</button>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="kicker">Write your sentences</div>
    <div id="list"></div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="kicker">Rubric (teacher)</div>
    <p class="small">
      2 points: correct + meaning is clear. 1 point: used but unclear. 0 points: missing/incorrect.
      (Teacher pages also have full answer guidance.)
    </p>
  </div>
</div>

<script>
const KEY="wm_progress_v1";
const words=[
  "stamina","evade","sketchy","tyrant","shirk","amicable","mettle","domineer","mundane",
  "disposition","enact","peaked","refuse","establish","lax","threshold","sneer","rigorous",
  "etiquette","bicker","derelict","faux pas","snicker","haggard","wrangle"
];

function render(){
  const root=document.getElementById("list");
  root.innerHTML="";
  words.forEach((w,i)=>{
    const div=document.createElement("div");
    div.className="q";
    div.innerHTML=`
      <div class="kicker">${i+1} of 25</div>
      <div style="font-weight:900;font-size:16px;margin-bottom:8px;">${w}</div>
      <textarea id="t_${i}" placeholder="Write a sentence using “${w}”…"></textarea>
      <div id="m_${i}" class="pill" style="margin-top:8px;">Not checked</div>
    `;
    root.appendChild(div);
  });
}

function wholeWordUsed(word, raw){
  const text = (raw||"");
  if(word === "faux pas") return text.toLowerCase().includes("faux pas");
  const re = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\$&")}\\b`, "i");
  return re.test(text);
}

function qualityScore(raw){
  const s = (raw||"").trim();
  let q=0;
  if(s.length >= 25) q++;                 // not too short
  if(/[.?!]$/.test(s)) q++;               // has ending punctuation
  if(/\b(because|so|although|however|when|while)\b/i.test(s)) q++; // has a connector
  // cap at 1 “quality point” for display; we just want simple signals
  return (q>=2) ? 1 : 0;
}

function check(){
  let used=0, qual=0;
  words.forEach((w,i)=>{
    const t=document.getElementById(`t_${i}`);
    const msg=document.getElementById(`m_${i}`);
    t.classList.remove("ok","bad");
    msg.classList.remove("ok","bad");

    const raw=t.value||"";
    const ok = wholeWordUsed(w, raw);

    if(ok){
      used++;
      t.classList.add("ok");
      msg.classList.add("ok");
      const q = qualityScore(raw);
      qual += q;
      msg.textContent = q ? "Used ✅ • Looks strong ✅" : "Used ✅ • Make it clearer (add detail).";
    }else{
      t.classList.add("bad");
      msg.classList.add("bad");
      msg.textContent="Missing word ❌";
    }
  });

  document.getElementById("score").textContent = `Used: ${used} / 25 • Quality: ${qual} / 25`;

  const p = JSON.parse(localStorage.getItem(KEY) || "{}");
  p.week2 = (used === 25 && qual >= 15);
  localStorage.setItem(KEY, JSON.stringify(p));
}

function resetAll(){
  words.forEach((_,i)=>{
    const t=document.getElementById(`t_${i}`);
    const msg=document.getElementById(`m_${i}`);
    t.value="";
    t.classList.remove("ok","bad");
    msg.classList.remove("ok","bad");
    msg.textContent="Not checked";
  });
  document.getElementById("score").textContent="Used: 0 / 25 • Quality: 0 / 25";
}

render();
</script>
</body>
</html>
